<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sign in — CodeLearn</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <main class="wrap" style="max-width:680px;padding:40px 20px">
        <h1>Sign in to CodeLearn</h1>
        <p class="muted">Create a free membership to track progress, save projects, and get certificates.</p>

        <div style="margin-top:18px;display:flex;gap:10px;align-items:center">
            <button id="googleBtn" class="btn btn-primary">Continue with Google</button>
            <a href="#email" class="btn btn-ghost">Use email</a>
        </div>

        <div style="margin-top:20px">
            <p class="muted">Or subscribe now for premium membership:</p>
            <button id="subscribeNow" class="btn btn-primary">Subscribe $100 / year</button>
        </div>

        <hr style="margin:20px 0;border:none;border-top:1px solid rgba(255,255,255,0.04)" />

        <form id="emailForm" style="display:block;max-width:520px" aria-label="Sign in with email">
            <label for="eName" style="display:block;margin-bottom:6px">Your name</label>
            <input id="eName" type="text" placeholder="Jane Developer" required
                style="width:100%;padding:10px;border-radius:8px;margin-bottom:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />
            <label for="eEmail" style="display:block;margin-bottom:6px">Email address</label>
            <input id="eEmail" type="email" placeholder="you@example.com" required
                style="width:100%;padding:10px;border-radius:8px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />
            <div style="display:flex;gap:10px">
                <button id="emailSubmit" class="btn btn-primary">Continue (free)</button>
                <a href="index.html" class="btn btn-ghost">Back</a>
            </div>
        </form>

        <p style="margin-top:18px;color:rgba(255,255,255,0.72)">By continuing you agree to our terms. This demo uses a
            simulated sign-in — for a real Google sign-in you'll need to configure OAuth client IDs and server
            endpoints.</p>
    </main>

    <script src="script.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const googleBtn = document.getElementById('googleBtn');
            const emailForm = document.getElementById('emailForm');
            const emailSubmit = document.getElementById('emailSubmit');

            // Simulated Google sign-in (demo). In production, wire real OAuth.
            googleBtn.addEventListener('click', () => {
                // Use exposed Auth API from script.js (mock)
                if (window.Auth && typeof window.Auth.signInWithGoogle === 'function') {
                    window.Auth.signInWithGoogle().then(() => {
                        window.location.href = 'index.html';
                    });
                } else {
                    // fallback: simple mock
                    localStorage.setItem('authUser', JSON.stringify({ name: 'Google User', email: 'you@google.com', provider: 'google' }));
                    window.location.href = 'index.html';
                }
            });

            emailForm.addEventListener('submit', (ev) => {
                ev.preventDefault();
                const name = document.getElementById('eName').value.trim();
                const email = document.getElementById('eEmail').value.trim();
                if (!email) return;
                if (window.Auth && typeof window.Auth.signInWithEmail === 'function') {
                    window.Auth.signInWithEmail(email, name).then(() => window.location.href = 'index.html');
                } else {
                    localStorage.setItem('authUser', JSON.stringify({ name: name || 'Member', email, provider: 'email' }));
                    window.location.href = 'index.html';
                }
            });

            // Subscribe now button: if signed in, redirect to index to complete PayPal checkout
            const subscribeNow = document.getElementById('subscribeNow');
            if (subscribeNow) {
                subscribeNow.addEventListener('click', () => {
                    const user = window.Auth && window.Auth.getCurrentUser && window.Auth.getCurrentUser();
                    if (!user) {
                        alert('Please sign in or enter your email below to subscribe.');
                        document.getElementById('eEmail').focus();
                        return;
                    }
                    // redirect to pricing page which will auto-start PayPal flow when authenticated
                    window.location.href = 'index.html?subscribe=1';
                });
            }
        });
    </script>
</body>

</html>